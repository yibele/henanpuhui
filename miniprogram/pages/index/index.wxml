<!--
  é¦–é¡µ Dashboard
  æ ¹æ®è§’è‰²æ˜¾ç¤ºä¸åŒå†…å®¹ï¼š
  - åŠ©ç†ï¼šæˆ‘çš„å·¥ä½œï¼ˆæˆ‘çš„å†œæˆ·ã€æˆ‘çš„å‘è‹—ã€å¿«æ·æ“ä½œï¼‰
  - ç®¡ç†å±‚ï¼šæ•°æ®æ€»è§ˆï¼ˆå…¨å…¬å¸ç»Ÿè®¡ï¼‰
-->
<view class="dashboard-page">
  <!-- ==================== åŠ©ç†è§†å›¾ ==================== -->
  <block wx:if="{{currentRoleKey === 'salesman'}}">
    <!-- æ¬¢è¿æ¨ªå¹… -->
    <view class="salesman-header">
      <view class="header-greeting">
        <text class="greeting-text">{{greeting}}ï¼Œ{{userName}}</text>
        <text class="greeting-sub">ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å“¦ ğŸ’ª</text>
      </view>
      <view class="header-logout" bindtap="onLogout">
        <t-icon name="poweroff" size="40rpx" color="#ffffff" />
      </view>
    </view>

    <!-- æˆ‘å½•å…¥çš„å†œæˆ·å¡ç‰‡ -->
    <view class="my-stats-card">
      <view class="my-stats-title">æˆ‘å½•å…¥çš„å†œæˆ·</view>
      <!-- ç¬¬ä¸€è¡Œï¼šç­¾çº¦æ•°æ® -->
      <view class="my-stats-row">
        <view class="my-stat-box" bindtap="goMyFarmers">
          <text class="my-stat-value">{{myStats.farmerCount}}</text>
          <text class="my-stat-label">ç­¾çº¦å†œæˆ·(æˆ·)</text>
        </view>
        <view class="my-stat-box">
          <text class="my-stat-value">{{myStats.acreage}}</text>
          <text class="my-stat-label">æ€»é¢ç§¯(äº©)</text>
        </view>
        <view class="my-stat-box">
          <text class="my-stat-value my-stat-green">{{myStats.depositFormat}}</text>
          <text class="my-stat-label">å®šé‡‘(å…ƒ)</text>
        </view>
      </view>
      <!-- ç¬¬äºŒè¡Œï¼šå‘è‹—æ•°æ® -->
      <view class="my-stats-row my-stats-row-seed">
        <view class="my-stat-box">
          <text class="my-stat-value my-stat-orange">{{myStats.seedCount}}</text>
          <text class="my-stat-label">å‘è‹—æ¬¡æ•°</text>
        </view>
        <view class="my-stat-box">
          <text class="my-stat-value">{{myStats.seedQuantity}}</text>
          <text class="my-stat-label">å‘è‹—æ•°é‡(kg)</text>
        </view>
        <view class="my-stat-box">
          <text class="my-stat-value my-stat-blue">{{myStats.seedAmountFormat}}</text>
          <text class="my-stat-label">è‹—æ¬¾é‡‘é¢(å…ƒ)</text>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="quick-section">
      <view class="quick-grid">
        <view class="quick-btn quick-btn-primary" bindtap="goAddFarmer">
          <view class="quick-btn-icon">
            <t-icon name="user-add" size="56rpx" color="#ffffff" />
          </view>
          <text class="quick-btn-text">å½•å…¥å†œæˆ·</text>
        </view>
        <view class="quick-btn quick-btn-secondary" bindtap="goAddSeed">
          <view class="quick-btn-icon">
            <t-icon name="corn" size="56rpx" color="#059669" />
          </view>
          <text class="quick-btn-text">å‘è‹—ç™»è®°</text>
        </view>
      </view>
    </view>

    <!-- æœ€è¿‘ç­¾çº¦ -->
    <view class="recent-section">
      <view class="section-header">
        <text class="section-title">æœ€è¿‘ç­¾çº¦</text>
        <view class="section-more" bindtap="goMyFarmers">
          <text>æŸ¥çœ‹å…¨éƒ¨</text>
          <t-icon name="chevron-right" size="32rpx" color="#059669" />
        </view>
      </view>
      
      <view class="recent-list" wx:if="{{recentFarmers.length > 0}}">
        <view class="recent-item" wx:for="{{recentFarmers}}" wx:key="id" bindtap="goFarmerDetail" data-id="{{item.id}}">
          <view class="recent-item-left">
            <view class="recent-avatar grade-bar-{{item.grade}}">
              <text>{{item.name[0]}}</text>
            </view>
            <view class="recent-info">
              <text class="recent-name">{{item.name}}</text>
              <text class="recent-meta">{{item.acreage}}äº© Â· {{item.phone}}</text>
            </view>
          </view>
          <text class="recent-date">{{item.contractDate}}</text>
        </view>
      </view>
      
      <view class="empty-recent" wx:else>
        <text>æš‚æ— ç­¾çº¦è®°å½•ï¼Œå¿«å»å½•å…¥å§~</text>
      </view>
    </view>
  </block>

  <!-- ==================== ä»“åº“ç®¡ç†å‘˜è§†å›¾ ==================== -->
  <block wx:if="{{currentRoleKey === 'warehouse'}}">
    <!-- æ¬¢è¿æ¨ªå¹… -->
    <view class="warehouse-header">
      <view class="warehouse-header-bg"></view>
      <view class="warehouse-header-content">
        <view class="header-greeting">
          <text class="greeting-text">{{greeting}}ï¼Œ{{userName}}</text>
          <text class="greeting-sub">{{warehouseInfo.name}}ä»“åº“</text>
        </view>
        <view class="warehouse-code-badge">
          <text class="code-label">ä»“åº“ç¼–å·</text>
          <text class="code-value">{{warehouseInfo.code}}</text>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥æ”¶è‹—æ•°æ®å¡ç‰‡ -->
    <view class="today-stats-card">
      <view class="stats-card-header">
        <view class="stats-card-title">
          <view class="title-icon">ğŸ“¦</view>
          <text>ä»Šæ—¥æ”¶è‹—</text>
        </view>
        <text class="stats-date">{{todayDate}}</text>
      </view>
      
      <view class="today-stats-row">
        <view class="today-stat-item">
          <text class="today-stat-value">{{warehouseStats.todayQuantity}}</text>
          <text class="today-stat-label">æ”¶è´­æ•°é‡ (kg)</text>
        </view>
        <view class="today-stat-divider"></view>
        <view class="today-stat-item">
          <text class="today-stat-value today-stat-green">{{warehouseStats.todayAmountWan}}</text>
          <text class="today-stat-label">æ”¶è´­é‡‘é¢ (ä¸‡å…ƒ)</text>
        </view>
        <view class="today-stat-divider"></view>
        <view class="today-stat-item">
          <text class="today-stat-value today-stat-blue">{{warehouseStats.todayFarmerCount}}</text>
          <text class="today-stat-label">å†œæˆ·æ•° (æˆ·)</text>
        </view>
      </view>
    </view>

    <!-- ç´¯è®¡æ•°æ®å¡ç‰‡ -->
    <view class="total-stats-card">
      <view class="stats-card-header">
        <view class="stats-card-title">
          <view class="title-icon">ğŸ“Š</view>
          <text>ç´¯è®¡æ•°æ®</text>
        </view>
      </view>
      
      <view class="total-stats-grid">
        <view class="total-stat-box">
          <text class="total-stat-label">ç´¯è®¡æ”¶è´­</text>
          <text class="total-stat-value">{{warehouseStats.totalQuantity}}</text>
          <text class="total-stat-unit">kg</text>
        </view>
        <view class="total-stat-box">
          <text class="total-stat-label">ç´¯è®¡é‡‘é¢</text>
          <text class="total-stat-value total-stat-green">{{warehouseStats.totalAmountWan}}</text>
          <text class="total-stat-unit">ä¸‡å…ƒ</text>
        </view>
        <view class="total-stat-box">
          <text class="total-stat-label">ç´¯è®¡å†œæˆ·</text>
          <text class="total-stat-value total-stat-blue">{{warehouseStats.totalFarmerCount}}</text>
          <text class="total-stat-unit">æˆ·</text>
        </view>
      </view>
    </view>

    <!-- åº“å­˜æ•°æ®å¡ç‰‡ -->
    <view class="stock-stats-card">
      <view class="stats-card-header">
        <view class="stats-card-title">
          <view class="title-icon">ğŸ“¦</view>
          <text>åº“å­˜æƒ…å†µ</text>
        </view>
      </view>
      
      <view class="stock-stats-row">
        <view class="stock-stat-item stock-current">
          <view class="stock-stat-top">
            <text class="stock-stat-label">å½“å‰åº“å­˜</text>
            <view class="stock-badge stock-badge-success">æ­£å¸¸</view>
          </view>
          <text class="stock-stat-value">{{warehouseStats.currentStock}}</text>
          <text class="stock-stat-unit">kg</text>
        </view>
        <view class="stock-stat-item stock-out">
          <view class="stock-stat-top">
            <text class="stock-stat-label">å·²å‡ºåº“</text>
          </view>
          <text class="stock-stat-value">{{warehouseStats.outStock}}</text>
          <text class="stock-stat-unit">kg</text>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="quick-actions">
      <view class="quick-action-title">å¿«æ·æ“ä½œ</view>
      <view class="quick-action-grid">
        <view class="quick-action-item" bindtap="goAcquisitionAdd">
          <view class="quick-action-icon quick-icon-green">
            <t-icon name="add-circle" size="48rpx" color="#ffffff" />
          </view>
          <text class="quick-action-text">æ”¶è´­ç™»è®°</text>
        </view>
        <view class="quick-action-item" bindtap="goStockManage">
          <view class="quick-action-icon quick-icon-blue">
            <t-icon name="order-list" size="48rpx" color="#ffffff" />
          </view>
          <text class="quick-action-text">åº“å­˜ç®¡ç†</text>
        </view>
        <view class="quick-action-item" bindtap="goAcquisitionList">
          <view class="quick-action-icon quick-icon-orange">
            <t-icon name="chart-bubble" size="48rpx" color="#ffffff" />
          </view>
          <text class="quick-action-text">æ”¶è´­è®°å½•</text>
        </view>
        <view class="quick-action-item" bindtap="goWarehouseReport">
          <view class="quick-action-icon quick-icon-purple">
            <t-icon name="chart-bar" size="48rpx" color="#ffffff" />
          </view>
          <text class="quick-action-text">æ•°æ®æŠ¥è¡¨</text>
        </view>
      </view>
    </view>
  </block>

  <!-- ==================== ç®¡ç†å±‚è§†å›¾ ==================== -->
  <block wx:if="{{currentRoleKey === 'finance'}}">
    <!-- æ¬¢è¿æ¨ªå¹… -->
    <view class="welcome-banner">
      <view class="banner-content">
        <view class="banner-left">
          <view class="banner-subtitle">æ•°æ®æ€»è§ˆ</view>
          <view class="banner-title">{{greeting}}ï¼Œ{{userName}}</view>
        </view>
        <view class="banner-right" bindtap="onScanTap">
          <t-icon name="qrcode" size="48rpx" color="#ffffff" />
        </view>
      </view>
    </view>

    <!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ -->
    <view class="overview-cards" wx:if="{{farmerSummary}}">
      <view class="overview-tab-bar">
        <view class="overview-tab {{overviewTab === 0 ? 'active' : ''}}" bindtap="switchOverviewTab" data-tab="0">
          <text>æ˜¨æ—¥æ–°å¢</text>
        </view>
        <view class="overview-tab {{overviewTab === 1 ? 'active' : ''}}" bindtap="switchOverviewTab" data-tab="1">
          <text>å…¨å¹´åº¦ç´¯è®¡</text>
        </view>
      </view>

      <view class="overview-row overview-row-3">
        <view class="overview-card" data-type="farmers" bindtap="onStatTap">
          <view class="overview-bg-icon">
            <t-icon name="user" size="80rpx" color="rgba(5, 150, 105, 0.1)" />
          </view>
          <view class="overview-info">
            <text class="overview-value">{{currentOverview.farmers}}</text>
            <text class="overview-label">ç­¾çº¦å†œæˆ·(æˆ·)</text>
          </view>
        </view>
        <view class="overview-card">
          <view class="overview-bg-icon">
            <t-icon name="location" size="80rpx" color="rgba(5, 150, 105, 0.1)" />
          </view>
          <view class="overview-info">
            <text class="overview-value">{{currentOverview.acreage}}</text>
            <text class="overview-label">ç§æ¤é¢ç§¯(äº©)</text>
          </view>
        </view>
        <view class="overview-card">
          <view class="overview-bg-icon">
            <t-icon name="money-circle" size="80rpx" color="rgba(5, 150, 105, 0.1)" />
          </view>
          <view class="overview-info">
            <text class="overview-value">{{currentOverview.deposit}}</text>
            <text class="overview-label">å®šé‡‘æ€»é¢(å…ƒ)</text>
          </view>
        </view>
      </view>

      <!-- ç­‰çº§åˆ†å¸ƒ -->
      <view class="grade-chart-card">
        <view class="grade-row">
          <view class="grade-row-left">
            <view class="grade-dot grade-dot-gold"></view>
            <text class="grade-name">é‡‘ç‰Œ</text>
          </view>
          <view class="grade-row-center">
            <view class="grade-bar-bg">
              <view class="grade-bar-fill grade-fill-gold" style="width: {{farmerSummary.gradeDistribution.goldPercent}}%;">
                <text class="grade-bar-percent">{{farmerSummary.gradeDistribution.goldPercent}}%</text>
              </view>
            </view>
          </view>
          <text class="grade-count">{{farmerSummary.gradeDistribution.gold}}æˆ·</text>
        </view>
        <view class="grade-row">
          <view class="grade-row-left">
            <view class="grade-dot grade-dot-silver"></view>
            <text class="grade-name">é“¶ç‰Œ</text>
          </view>
          <view class="grade-row-center">
            <view class="grade-bar-bg">
              <view class="grade-bar-fill grade-fill-silver" style="width: {{farmerSummary.gradeDistribution.silverPercent}}%;">
                <text class="grade-bar-percent">{{farmerSummary.gradeDistribution.silverPercent}}%</text>
              </view>
            </view>
          </view>
          <text class="grade-count">{{farmerSummary.gradeDistribution.silver}}æˆ·</text>
        </view>
        <view class="grade-row">
          <view class="grade-row-left">
            <view class="grade-dot grade-dot-bronze"></view>
            <text class="grade-name">é“œç‰Œ</text>
          </view>
          <view class="grade-row-center">
            <view class="grade-bar-bg">
              <view class="grade-bar-fill grade-fill-bronze" style="width: {{farmerSummary.gradeDistribution.bronzePercent}}%;">
                <text class="grade-bar-percent">{{farmerSummary.gradeDistribution.bronzePercent}}%</text>
              </view>
            </view>
          </view>
          <text class="grade-count">{{farmerSummary.gradeDistribution.bronze}}æˆ·</text>
        </view>
      </view>
    </view>

    <!-- è´Ÿè´£äººç»Ÿè®¡ -->
    <view class="section">
      <view class="section-header-row">
        <text class="section-title">è´Ÿè´£äººç­¾çº¦ç»Ÿè®¡</text>
        <view class="section-detail-btn" bindtap="goSalesmanDetail">
          <text>è¯¦æƒ…</text>
          <t-icon name="chevron-right" size="32rpx" color="#059669" />
        </view>
      </view>
      
      <view class="salesman-tab-bar">
        <view class="salesman-tab {{salesmanTab === 0 ? 'active' : ''}}" bindtap="switchSalesmanTab" data-tab="0">
          <text>æ˜¨æ—¥æ–°å¢</text>
        </view>
        <view class="salesman-tab {{salesmanTab === 1 ? 'active' : ''}}" bindtap="switchSalesmanTab" data-tab="1">
          <text>å…¨å¹´åº¦</text>
        </view>
      </view>
      
      <view class="card salesman-card">
        <block wx:if="{{displaySalesmanList.length > 0}}">
          <view class="salesman-table-header">
            <text class="col-rank">#</text>
            <text class="col-name">è´Ÿè´£äºº</text>
            <text class="col-count">å†œæˆ·</text>
            <text class="col-acreage">é¢ç§¯</text>
            <text class="col-deposit">å®šé‡‘</text>
          </view>
          
          <view class="salesman-list">
            <view class="salesman-item" wx:for="{{displaySalesmanList}}" wx:key="salesmanId">
              <text class="col-rank item-rank">{{item.rank}}</text>
              <text class="col-name item-name">{{item.salesmanName}}</text>
              <text class="col-count item-count">{{item.farmerCount}}</text>
              <text class="col-acreage item-acreage">{{item.formatAcreage}}</text>
              <text class="col-deposit item-deposit">{{item.formatDeposit}}</text>
            </view>
          </view>
          
          <view class="salesman-expand" bindtap="toggleSalesmanExpand" wx:if="{{salesmanStats.length > 5}}">
            <text>{{salesmanExpanded ? 'æ”¶èµ·' : 'æŸ¥çœ‹æ›´å¤š'}}</text>
            <t-icon name="{{salesmanExpanded ? 'chevron-up' : 'chevron-down'}}" size="32rpx" color="#059669" />
          </view>
        </block>
        
        <view class="salesman-empty" wx:else>
          <t-icon name="info-circle" size="64rpx" color="#d1d5db" />
          <text class="empty-text">æ˜¨æ—¥æš‚æ— æ–°å¢ç­¾çº¦</text>
        </view>
      </view>
    </view>

    <!-- å‘è‹—ç»Ÿè®¡ -->
    <view class="section" wx:if="{{seedYesterday && seedYearTotal}}">
      <view class="section-header-row">
        <text class="section-title">å‘è‹—ç»Ÿè®¡</text>
        <view class="section-detail-btn" bindtap="goSeedDetail">
          <text>è¯¦æƒ…</text>
          <t-icon name="chevron-right" size="32rpx" color="#059669" />
        </view>
      </view>
      
      <view class="card seed-stats-card" bindtap="goSeedDetail">
        <view class="seed-stats-header">
          <view class="seed-stats-title">
            <text>ç”œå¶èŠ</text>
            <t-icon name="chevron-right" size="28rpx" color="#9ca3af" />
          </view>
          <view class="seed-stats-tabs">
            <view class="seed-tab {{seedStatsTab === 0 ? 'seed-tab-active' : ''}}" catchtap="onSeedStatsTabChange" data-value="{{0}}">æ˜¨æ—¥</view>
            <view class="seed-tab {{seedStatsTab === 1 ? 'seed-tab-active' : ''}}" catchtap="onSeedStatsTabChange" data-value="{{1}}">å¹´åº¦ç´¯è®¡</view>
          </view>
        </view>

        <view class="seed-overview">
          <view class="seed-overview-progress">
            <view class="seed-overview-info">
              <text class="seed-overview-label">å‘è‹—è¿›åº¦</text>
              <text class="seed-overview-value">{{seedYearTotal.distributedFarmerCount}}/{{seedYearTotal.totalFarmerCount}}æˆ·</text>
            </view>
            <view class="seed-overview-percent">{{seedYearTotal.distributionPercent}}%</view>
          </view>
          <view class="seed-overview-bar">
            <view class="seed-overview-fill" style="width: {{seedYearTotal.distributionPercent}}%;"></view>
          </view>
        </view>

        <view class="seed-stats-content" wx:if="{{seedStatsTab === 0}}">
          <view class="seed-core-stats">
            <view class="seed-core-item">
              <text class="seed-core-value">{{seedYesterdayFormat.quantity}}</text>
              <text class="seed-core-label">å‘æ”¾</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value">{{seedYesterdayFormat.amount}}</text>
              <text class="seed-core-label">é‡‘é¢</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value seed-value-green">{{seedYesterdayFormat.paid}}</text>
              <text class="seed-core-label">å·²æ”¶</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value seed-value-orange">{{seedYesterdayFormat.unpaid}}</text>
              <text class="seed-core-label">æ¬ æ¬¾</text>
            </view>
          </view>
        </view>

        <view class="seed-stats-content" wx:if="{{seedStatsTab === 1}}">
          <view class="seed-core-stats">
            <view class="seed-core-item">
              <text class="seed-core-value">{{seedYearFormat.quantity}}</text>
              <text class="seed-core-label">å‘æ”¾</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value">{{seedYearFormat.amount}}</text>
              <text class="seed-core-label">é‡‘é¢</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value seed-value-green">{{seedYearFormat.paid}}</text>
              <text class="seed-core-label">å·²æ”¶</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value seed-value-orange">{{seedYearFormat.unpaid}}</text>
              <text class="seed-core-label">æ¬ æ¬¾</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </block>

  <!-- åº•éƒ¨é—´è· -->
  <view class="bottom-space"></view>
</view>
