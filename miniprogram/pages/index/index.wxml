<!--
  é¦–é¡µ Dashboard
  æ ¹æ®è§’è‰²æ˜¾ç¤ºä¸åŒå†…å®¹ï¼š
  - ä¸šåŠ¡å‘˜ï¼šæˆ‘çš„å·¥ä½œï¼ˆæˆ‘çš„å†œæˆ·ã€æˆ‘çš„å‘è‹—ã€å¿«æ·æ“ä½œï¼‰
  - ç®¡ç†å±‚ï¼šæ•°æ®æ€»è§ˆï¼ˆå…¨å…¬å¸ç»Ÿè®¡ï¼‰
-->
<view class="dashboard-page">
  <!-- å¼€å‘æµ‹è¯•ï¼šè§’è‰²åˆ‡æ¢æŒ‰é’® -->
  <view class="dev-role-switcher" bindtap="onSwitchRole">
    <view class="role-badge role-badge-{{currentRoleKey}}">
      <t-icon name="user-setting" size="28rpx" color="#ffffff" />
      <text class="role-badge-text">{{currentRoleName}}</text>
    </view>
    <text class="switch-hint">ç‚¹å‡»åˆ‡æ¢</text>
  </view>

  <!-- ==================== ä¸šåŠ¡å‘˜è§†å›¾ ==================== -->
  <block wx:if="{{currentRoleKey === 'salesman'}}">
    <!-- æ¬¢è¿æ¨ªå¹… -->
    <view class="salesman-header">
      <view class="header-greeting">
        <text class="greeting-text">{{greeting}}ï¼Œ{{userName}}</text>
        <text class="greeting-sub">ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å“¦ ğŸ’ª</text>
      </view>
    </view>

    <!-- æˆ‘çš„ä¸šç»©å¡ç‰‡ -->
    <view class="my-stats-card">
      <view class="my-stats-title">æˆ‘çš„ä¸šç»©</view>
      <view class="my-stats-grid">
        <view class="my-stat-item" bindtap="goMyFarmers">
          <text class="my-stat-value">{{myStats.farmerCount}}</text>
          <text class="my-stat-label">ç­¾çº¦å†œæˆ·</text>
        </view>
        <view class="my-stat-divider"></view>
        <view class="my-stat-item">
          <text class="my-stat-value">{{myStats.acreage}}</text>
          <text class="my-stat-label">æ€»é¢ç§¯(äº©)</text>
        </view>
        <view class="my-stat-divider"></view>
        <view class="my-stat-item">
          <text class="my-stat-value my-stat-orange">{{myStats.seedCount}}</text>
          <text class="my-stat-label">å‘è‹—æ¬¡æ•°</text>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="quick-section">
      <view class="quick-grid">
        <view class="quick-btn quick-btn-primary" bindtap="goAddFarmer">
          <view class="quick-btn-icon">
            <t-icon name="user-add" size="56rpx" color="#ffffff" />
          </view>
          <text class="quick-btn-text">å½•å…¥å†œæˆ·</text>
        </view>
        <view class="quick-btn quick-btn-secondary" bindtap="goAddSeed">
          <view class="quick-btn-icon">
            <t-icon name="corn" size="56rpx" color="#059669" />
          </view>
          <text class="quick-btn-text">å‘è‹—ç™»è®°</text>
        </view>
      </view>
    </view>

    <!-- æœ€è¿‘ç­¾çº¦ -->
    <view class="recent-section">
      <view class="section-header">
        <text class="section-title">æœ€è¿‘ç­¾çº¦</text>
        <view class="section-more" bindtap="goMyFarmers">
          <text>æŸ¥çœ‹å…¨éƒ¨</text>
          <t-icon name="chevron-right" size="32rpx" color="#059669" />
        </view>
      </view>
      
      <view class="recent-list" wx:if="{{recentFarmers.length > 0}}">
        <view class="recent-item" wx:for="{{recentFarmers}}" wx:key="id" bindtap="goFarmerDetail" data-id="{{item.id}}">
          <view class="recent-item-left">
            <view class="recent-avatar grade-bar-{{item.grade}}">
              <text>{{item.name[0]}}</text>
            </view>
            <view class="recent-info">
              <text class="recent-name">{{item.name}}</text>
              <text class="recent-meta">{{item.acreage}}äº© Â· {{item.phone}}</text>
            </view>
          </view>
          <text class="recent-date">{{item.contractDate}}</text>
        </view>
      </view>
      
      <view class="empty-recent" wx:else>
        <text>æš‚æ— ç­¾çº¦è®°å½•ï¼Œå¿«å»å½•å…¥å§~</text>
      </view>
    </view>
  </block>

  <!-- ==================== ç®¡ç†å±‚è§†å›¾ ==================== -->
  <block wx:if="{{currentRoleKey === 'finance'}}">
    <!-- æ¬¢è¿æ¨ªå¹… -->
    <view class="welcome-banner">
      <view class="banner-content">
        <view class="banner-left">
          <view class="banner-subtitle">æ•°æ®æ€»è§ˆ</view>
          <view class="banner-title">{{greeting}}ï¼Œ{{userName}}</view>
        </view>
        <view class="banner-right" bindtap="onScanTap">
          <t-icon name="qrcode" size="48rpx" color="#ffffff" />
        </view>
      </view>
    </view>

    <!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ -->
    <view class="overview-cards" wx:if="{{farmerSummary}}">
      <view class="overview-tab-bar">
        <view class="overview-tab {{overviewTab === 0 ? 'active' : ''}}" bindtap="switchOverviewTab" data-tab="0">
          <text>æ˜¨æ—¥æ–°å¢</text>
        </view>
        <view class="overview-tab {{overviewTab === 1 ? 'active' : ''}}" bindtap="switchOverviewTab" data-tab="1">
          <text>å…¨å¹´åº¦ç´¯è®¡</text>
        </view>
      </view>

      <view class="overview-row overview-row-3">
        <view class="overview-card" data-type="farmers" bindtap="onStatTap">
          <view class="overview-bg-icon">
            <t-icon name="user" size="80rpx" color="rgba(5, 150, 105, 0.1)" />
          </view>
          <view class="overview-info">
            <text class="overview-value">{{currentOverview.farmers}}</text>
            <text class="overview-label">ç­¾çº¦å†œæˆ·(æˆ·)</text>
          </view>
        </view>
        <view class="overview-card">
          <view class="overview-bg-icon">
            <t-icon name="location" size="80rpx" color="rgba(5, 150, 105, 0.1)" />
          </view>
          <view class="overview-info">
            <text class="overview-value">{{currentOverview.acreage}}</text>
            <text class="overview-label">ç§æ¤é¢ç§¯(äº©)</text>
          </view>
        </view>
        <view class="overview-card">
          <view class="overview-bg-icon">
            <t-icon name="money-circle" size="80rpx" color="rgba(5, 150, 105, 0.1)" />
          </view>
          <view class="overview-info">
            <text class="overview-value">{{currentOverview.deposit}}</text>
            <text class="overview-label">å®šé‡‘æ€»é¢(å…ƒ)</text>
          </view>
        </view>
      </view>

      <!-- ç­‰çº§åˆ†å¸ƒ -->
      <view class="grade-chart-card">
        <view class="grade-row">
          <view class="grade-row-left">
            <view class="grade-dot grade-dot-gold"></view>
            <text class="grade-name">é‡‘ç‰Œ</text>
          </view>
          <view class="grade-row-center">
            <view class="grade-bar-bg">
              <view class="grade-bar-fill grade-fill-gold" style="width: {{farmerSummary.gradeDistribution.goldPercent}}%;">
                <text class="grade-bar-percent">{{farmerSummary.gradeDistribution.goldPercent}}%</text>
              </view>
            </view>
          </view>
          <text class="grade-count">{{farmerSummary.gradeDistribution.gold}}æˆ·</text>
        </view>
        <view class="grade-row">
          <view class="grade-row-left">
            <view class="grade-dot grade-dot-silver"></view>
            <text class="grade-name">é“¶ç‰Œ</text>
          </view>
          <view class="grade-row-center">
            <view class="grade-bar-bg">
              <view class="grade-bar-fill grade-fill-silver" style="width: {{farmerSummary.gradeDistribution.silverPercent}}%;">
                <text class="grade-bar-percent">{{farmerSummary.gradeDistribution.silverPercent}}%</text>
              </view>
            </view>
          </view>
          <text class="grade-count">{{farmerSummary.gradeDistribution.silver}}æˆ·</text>
        </view>
        <view class="grade-row">
          <view class="grade-row-left">
            <view class="grade-dot grade-dot-bronze"></view>
            <text class="grade-name">é“œç‰Œ</text>
          </view>
          <view class="grade-row-center">
            <view class="grade-bar-bg">
              <view class="grade-bar-fill grade-fill-bronze" style="width: {{farmerSummary.gradeDistribution.bronzePercent}}%;">
                <text class="grade-bar-percent">{{farmerSummary.gradeDistribution.bronzePercent}}%</text>
              </view>
            </view>
          </view>
          <text class="grade-count">{{farmerSummary.gradeDistribution.bronze}}æˆ·</text>
        </view>
      </view>
    </view>

    <!-- è´Ÿè´£äººç»Ÿè®¡ -->
    <view class="section">
      <view class="section-header-row">
        <text class="section-title">è´Ÿè´£äººç­¾çº¦ç»Ÿè®¡</text>
        <view class="section-detail-btn" bindtap="goSalesmanDetail">
          <text>è¯¦æƒ…</text>
          <t-icon name="chevron-right" size="32rpx" color="#059669" />
        </view>
      </view>
      
      <view class="salesman-tab-bar">
        <view class="salesman-tab {{salesmanTab === 0 ? 'active' : ''}}" bindtap="switchSalesmanTab" data-tab="0">
          <text>æ˜¨æ—¥æ–°å¢</text>
        </view>
        <view class="salesman-tab {{salesmanTab === 1 ? 'active' : ''}}" bindtap="switchSalesmanTab" data-tab="1">
          <text>å…¨å¹´åº¦</text>
        </view>
      </view>
      
      <view class="card salesman-card">
        <block wx:if="{{displaySalesmanList.length > 0}}">
          <view class="salesman-table-header">
            <text class="col-rank">#</text>
            <text class="col-name">è´Ÿè´£äºº</text>
            <text class="col-count">å†œæˆ·</text>
            <text class="col-acreage">é¢ç§¯</text>
            <text class="col-deposit">å®šé‡‘</text>
          </view>
          
          <view class="salesman-list">
            <view class="salesman-item" wx:for="{{displaySalesmanList}}" wx:key="salesmanId">
              <text class="col-rank item-rank">{{item.rank}}</text>
              <text class="col-name item-name">{{item.salesmanName}}</text>
              <text class="col-count item-count">{{item.farmerCount}}</text>
              <text class="col-acreage item-acreage">{{item.formatAcreage}}</text>
              <text class="col-deposit item-deposit">{{item.formatDeposit}}</text>
            </view>
          </view>
          
          <view class="salesman-expand" bindtap="toggleSalesmanExpand" wx:if="{{salesmanStats.length > 5}}">
            <text>{{salesmanExpanded ? 'æ”¶èµ·' : 'æŸ¥çœ‹æ›´å¤š'}}</text>
            <t-icon name="{{salesmanExpanded ? 'chevron-up' : 'chevron-down'}}" size="32rpx" color="#059669" />
          </view>
        </block>
        
        <view class="salesman-empty" wx:else>
          <t-icon name="info-circle" size="64rpx" color="#d1d5db" />
          <text class="empty-text">æ˜¨æ—¥æš‚æ— æ–°å¢ç­¾çº¦</text>
        </view>
      </view>
    </view>

    <!-- å‘è‹—ç»Ÿè®¡ -->
    <view class="section" wx:if="{{seedYesterday && seedYearTotal}}">
      <view class="section-header-row">
        <text class="section-title">å‘è‹—ç»Ÿè®¡</text>
        <view class="section-detail-btn" bindtap="goSeedDetail">
          <text>è¯¦æƒ…</text>
          <t-icon name="chevron-right" size="32rpx" color="#059669" />
        </view>
      </view>
      
      <view class="card seed-stats-card" bindtap="goSeedDetail">
        <view class="seed-stats-header">
          <view class="seed-stats-title">
            <text>ç”œå¶èŠ</text>
            <t-icon name="chevron-right" size="28rpx" color="#9ca3af" />
          </view>
          <view class="seed-stats-tabs">
            <view class="seed-tab {{seedStatsTab === 0 ? 'seed-tab-active' : ''}}" catchtap="onSeedStatsTabChange" data-value="{{0}}">æ˜¨æ—¥</view>
            <view class="seed-tab {{seedStatsTab === 1 ? 'seed-tab-active' : ''}}" catchtap="onSeedStatsTabChange" data-value="{{1}}">å¹´åº¦ç´¯è®¡</view>
          </view>
        </view>

        <view class="seed-overview">
          <view class="seed-overview-progress">
            <view class="seed-overview-info">
              <text class="seed-overview-label">å‘è‹—è¿›åº¦</text>
              <text class="seed-overview-value">{{seedYearTotal.distributedFarmerCount}}/{{seedYearTotal.totalFarmerCount}}æˆ·</text>
            </view>
            <view class="seed-overview-percent">{{seedYearTotal.distributionPercent}}%</view>
          </view>
          <view class="seed-overview-bar">
            <view class="seed-overview-fill" style="width: {{seedYearTotal.distributionPercent}}%;"></view>
          </view>
        </view>

        <view class="seed-stats-content" wx:if="{{seedStatsTab === 0}}">
          <view class="seed-core-stats">
            <view class="seed-core-item">
              <text class="seed-core-value">{{seedYesterdayFormat.quantity}}</text>
              <text class="seed-core-label">å‘æ”¾</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value">{{seedYesterdayFormat.amount}}</text>
              <text class="seed-core-label">é‡‘é¢</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value seed-value-green">{{seedYesterdayFormat.paid}}</text>
              <text class="seed-core-label">å·²æ”¶</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value seed-value-orange">{{seedYesterdayFormat.unpaid}}</text>
              <text class="seed-core-label">æ¬ æ¬¾</text>
            </view>
          </view>
        </view>

        <view class="seed-stats-content" wx:if="{{seedStatsTab === 1}}">
          <view class="seed-core-stats">
            <view class="seed-core-item">
              <text class="seed-core-value">{{seedYearFormat.quantity}}</text>
              <text class="seed-core-label">å‘æ”¾</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value">{{seedYearFormat.amount}}</text>
              <text class="seed-core-label">é‡‘é¢</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value seed-value-green">{{seedYearFormat.paid}}</text>
              <text class="seed-core-label">å·²æ”¶</text>
            </view>
            <view class="seed-core-divider"></view>
            <view class="seed-core-item">
              <text class="seed-core-value seed-value-orange">{{seedYearFormat.unpaid}}</text>
              <text class="seed-core-label">æ¬ æ¬¾</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </block>

  <!-- åº•éƒ¨é—´è· -->
  <view class="bottom-space"></view>
</view>
