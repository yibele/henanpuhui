<!--
  仓库看板页面
-->
<view class="page-container">
  <!-- 仓库名称 -->
  <view class="page-header">
    <text class="page-title">{{warehouseName}}</text>
  </view>

  <!-- 今日看板 -->
  <view class="today-board">
    <view class="board-title">今日数据 · {{todayDisplay}}</view>
    
    <!-- 今日统计：收购(自动) + 打包(手动) -->
    <view class="today-row">
      <view class="today-col">
        <text class="today-num">{{todayData.acquisitionWeight}}<text class="unit">kg</text></text>
        <text class="today-label">今日收购</text>
      </view>
      <view class="today-col">
        <text class="today-num">{{todayData.packCount || 0}}<text class="unit">包</text></text>
        <text class="today-label">今日打包</text>
      </view>
    </view>

    <!-- 库存统计 -->
    <view class="stock-section">
      <view class="stock-title">库存统计</view>
      <view class="today-row">
        <view class="today-col">
          <text class="today-num highlight">{{totalStats.stockWeight}}<text class="unit">kg</text></text>
          <text class="today-label">库存重量</text>
        </view>
        <view class="today-col">
          <text class="today-num">{{totalStats.stockCount}}<text class="unit">包</text></text>
          <text class="today-label">库存包数</text>
        </view>
      </view>
      <view class="stock-detail">
        <text>累计收购 {{totalStats.totalAcquisition || 0}}kg</text>
        <text>累计打包 {{totalStats.totalPack || 0}}包</text>
      </view>
      <view class="stock-detail">
        <text>累计出库 {{totalStats.totalOutWeight || 0}}kg</text>
        <text>累计出库 {{totalStats.totalOutCount || 0}}包</text>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons single">
      <view class="action-btn primary" bindtap="showEditPopup">
        <t-icon name="edit" size="36rpx" />
        <text>填写今日数据</text>
      </view>
    </view>
  </view>

  <!-- 历史记录 -->
  <view class="history-section">
    <view class="section-header">
      <text class="section-title">历史记录</text>
      <text class="record-count">共{{historyList.length}}条</text>
    </view>

    <view class="history-list" wx:if="{{historyList.length > 0}}">
      <view class="history-item" wx:for="{{historyList}}" wx:key="date">
        <view class="history-date">{{item.dateDisplay}}</view>
        <view class="history-data">
          <view class="data-cell">
            <text class="cell-label">收购</text>
            <text class="cell-value">{{item.acquisitionWeight}}kg</text>
          </view>
          <view class="data-cell">
            <text class="cell-label">打包</text>
            <text class="cell-value">{{item.packCount || 0}}包</text>
          </view>
          <view class="data-cell">
            <text class="cell-label">出库</text>
            <text class="cell-value">{{item.outWeight || 0}}kg</text>
          </view>
        </view>
      </view>
    </view>

    <view class="empty-state" wx:if="{{historyList.length === 0 && !loading}}">
      <text class="empty-text">暂无历史记录</text>
    </view>

    <view class="load-more" wx:if="{{hasMore}}" bindtap="loadMore">
      <text>{{loading ? '加载中...' : '加载更多'}}</text>
    </view>
  </view>

  <!-- 加载中 -->
  <view class="loading-wrap" wx:if="{{loading && historyList.length === 0}}">
    <t-loading theme="circular" size="40rpx" text="加载中..." />
  </view>
</view>

<!-- 编辑弹窗：打包 + 出库 -->
<t-popup visible="{{showEdit}}" placement="bottom" bind:visible-change="onEditPopupChange">
  <view class="edit-popup">
    <view class="popup-header">
      <text class="popup-title">填写今日数据</text>
      <view class="popup-close" bindtap="closeEditPopup">
        <t-icon name="close" size="40rpx" />
      </view>
    </view>
    <view class="popup-date">{{editDate}}</view>
    
    <!-- 今日收购（只读） -->
    <view class="popup-info-row">
      <text class="info-label">今日收购（自动）</text>
      <text class="info-value">{{todayData.acquisitionWeight}} kg</text>
    </view>
    
    <!-- 今日打包 -->
    <view class="popup-input-section">
      <text class="input-label">今日打包</text>
      <view class="input-wrap">
        <input class="popup-input" type="number" value="{{packCountInput}}" bindinput="onPackInput" placeholder="请输入包数" />
        <text class="input-unit">包</text>
      </view>
    </view>
    
    <!-- 今日出库 -->
    <view class="popup-input-section">
      <text class="input-label">今日出库重量</text>
      <view class="input-wrap">
        <input class="popup-input" type="digit" value="{{outWeightInput}}" bindinput="onOutWeightInput" placeholder="请输入" />
        <text class="input-unit">kg</text>
      </view>
    </view>
    <view class="popup-input-section">
      <text class="input-label">今日出库包数</text>
      <view class="input-wrap">
        <input class="popup-input" type="number" value="{{outCountInput}}" bindinput="onOutCountInput" placeholder="请输入" />
        <text class="input-unit">包</text>
      </view>
    </view>
    
    <view class="popup-footer">
      <t-button theme="primary" size="large" block bindtap="saveDaily" loading="{{saving}}">
        保存
      </t-button>
    </view>
  </view>
</t-popup>
