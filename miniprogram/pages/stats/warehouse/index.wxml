<!--
  仓库日报页面
  日期列表形式，每天一条记录
-->
<view class="page-container">
  <!-- 仓库标题 -->
  <view class="page-header">
    <text class="page-title">{{warehouseName}}</text>
    <view class="header-stats">
      <view class="stat-item">
        <text class="stat-num">{{totalStats.stockWeight}}</text>
        <text class="stat-label">库存(kg)</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{totalStats.stockCount}}</text>
        <text class="stat-label">库存(包)</text>
      </view>
    </view>
  </view>

  <!-- 日期列表 -->
  <view class="daily-list">
    <view class="daily-item" wx:for="{{dailyList}}" wx:key="date">
      <view class="daily-header">
        <text class="daily-date">{{item.dateDisplay}}</text>
        <view class="edit-btn" catchtap="editDaily" data-item="{{item}}">
          <t-icon name="edit" size="32rpx" />
          <text>编辑</text>
        </view>
      </view>
      
      <view class="daily-body">
        <view class="data-col">
          <text class="data-label">收购</text>
          <text class="data-value">{{item.acquisitionWeight}}kg</text>
        </view>
        <view class="data-col">
          <text class="data-label">打包</text>
          <text class="data-value {{item.packCount > 0 ? '' : 'empty'}}">{{item.packCount || '-'}}包</text>
        </view>
        <view class="data-col">
          <text class="data-label">出库</text>
          <text class="data-value {{item.outboundWeight > 0 ? '' : 'empty'}}">
            {{item.outboundWeight || '-'}}kg/{{item.outboundCount || '-'}}包
          </text>
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{hasMore}}" bindtap="loadMore">
      <text>{{loading ? '加载中...' : '加载更多'}}</text>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{dailyList.length === 0 && !loading}}">
      <text class="empty-text">暂无数据</text>
    </view>
  </view>

  <!-- 加载中 -->
  <view class="loading-wrap" wx:if="{{loading && dailyList.length === 0}}">
    <t-loading theme="circular" size="40rpx" text="加载中..." />
  </view>
</view>

<!-- 编辑弹窗 -->
<t-popup visible="{{showEdit}}" placement="bottom" bind:visible-change="onEditPopupChange">
  <view class="edit-popup">
    <view class="popup-header">
      <text class="popup-title">{{editDate}} 数据填写</text>
      <view class="popup-close" bindtap="closeEdit">
        <t-icon name="close" size="40rpx" />
      </view>
    </view>

    <!-- 收购（只读） -->
    <view class="edit-row">
      <text class="edit-label">当日收购</text>
      <text class="edit-value readonly">{{editData.acquisitionWeight}} kg（自动统计）</text>
    </view>

    <!-- 打包 -->
    <view class="edit-row">
      <text class="edit-label">当日打包</text>
      <view class="edit-input-wrap">
        <input class="edit-input" type="number" value="{{editData.packCount}}" bindinput="onPackInput" placeholder="请输入" />
        <text class="edit-unit">包</text>
      </view>
    </view>

    <!-- 出库重量 -->
    <view class="edit-row">
      <text class="edit-label">出库重量</text>
      <view class="edit-input-wrap">
        <input class="edit-input" type="digit" value="{{editData.outboundWeight}}" bindinput="onOutboundWeightInput" placeholder="请输入" />
        <text class="edit-unit">kg</text>
      </view>
    </view>

    <!-- 出库包数 -->
    <view class="edit-row">
      <text class="edit-label">出库包数</text>
      <view class="edit-input-wrap">
        <input class="edit-input" type="number" value="{{editData.outboundCount}}" bindinput="onOutboundCountInput" placeholder="请输入" />
        <text class="edit-unit">包</text>
      </view>
    </view>

    <!-- 提交按钮 -->
    <view class="popup-footer">
      <t-button theme="primary" size="large" block bindtap="saveDaily" loading="{{saving}}">
        保存
      </t-button>
    </view>
  </view>
</t-popup>
