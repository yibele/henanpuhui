<!--
  仓库管理列表页面
  自己的仓库在上方可操作，其他仓库简要显示库存
-->
<view class="page-container">
  <!-- 我的仓库（可操作） -->
  <view class="my-warehouse-section" wx:if="{{myWarehouse}}">
    <view class="my-warehouse-card">
      <view class="my-header">
        <view class="my-title">
          <text class="my-name">{{myWarehouse.name}}</text>
          <view class="my-tag">我的仓库</view>
        </view>
        <text class="my-date">{{todayDate}}</text>
      </view>

      <!-- 今日数据 -->
      <view class="my-stats">
        <view class="stat-block">
          <text class="stat-num">{{myWarehouse.today.acquisitionWeight}}</text>
          <text class="stat-label">今日收购(kg)</text>
        </view>
        <view class="stat-block">
          <text class="stat-num">{{myWarehouse.today.packCount}}</text>
          <text class="stat-label">今日打包(包)</text>
        </view>
        <view class="stat-block">
          <text class="stat-num">{{myWarehouse.today.outboundWeight}}</text>
          <text class="stat-label">今日出库(kg)</text>
        </view>
      </view>

      <!-- 库存信息 -->
      <view class="my-stock">
        <view class="stock-block">
          <text class="stock-num highlight">{{myWarehouse.stock.weight}}</text>
          <text class="stock-label">库存重量(kg)</text>
        </view>
        <view class="stock-block">
          <text class="stock-num">{{myWarehouse.stock.count}}</text>
          <text class="stock-label">库存包数</text>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="my-actions">
        <view class="action-btn" bindtap="showPackPopup">
          <text class="action-text">填写打包</text>
        </view>
        <view class="action-btn primary" bindtap="showOutboundPopup">
          <text class="action-text">填写出库</text>
        </view>
      </view>
      
      <!-- 查看详情入口 -->
      <view class="detail-entry" bindtap="goToDetail">
        <text class="detail-text">查看收购记录</text>
        <t-icon name="chevron-right" size="36rpx" color="#ffffff" />
      </view>
    </view>
  </view>

  <!-- 其他仓库列表 -->
  <view class="other-section" wx:if="{{otherWarehouses.length > 0}}">
    <view class="section-title">其他仓库</view>
    <view class="other-list">
      <view class="other-item" wx:for="{{otherWarehouses}}" wx:key="_id">
        <text class="other-name">{{item.name}}</text>
        <view class="other-data">
          <text class="other-stock">{{item.stock.weight}}kg</text>
          <text class="other-count">{{item.stock.count}}包</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载中 -->
  <view class="loading-wrap" wx:if="{{loading}}">
    <t-loading theme="circular" size="40rpx" text="加载中..." />
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && !myWarehouse && otherWarehouses.length === 0}}">
    <text class="empty-text">暂无仓库数据</text>
  </view>
</view>

<!-- 打包弹窗 -->
<t-popup visible="{{showPack}}" placement="bottom" bind:visible-change="onPackPopupChange">
  <view class="popup-box">
    <view class="popup-title">填写打包数量</view>
    <view class="popup-input-row">
      <input class="popup-input" type="number" placeholder="请输入包数" value="{{packCount}}" bindinput="onPackInput" />
      <text class="popup-unit">包</text>
    </view>
    <view class="popup-btn-row">
      <view class="popup-btn cancel" bindtap="closePackPopup">取消</view>
      <view class="popup-btn confirm" bindtap="submitPack">确认</view>
    </view>
  </view>
</t-popup>

<!-- 出库弹窗 -->
<t-popup visible="{{showOutbound}}" placement="bottom" bind:visible-change="onOutboundPopupChange">
  <view class="popup-box">
    <view class="popup-title">填写出库</view>
    <view class="popup-input-row">
      <text class="popup-label">重量</text>
      <input class="popup-input" type="digit" placeholder="可正负" value="{{outboundWeight}}" bindinput="onOutboundWeightInput" />
      <text class="popup-unit">kg</text>
    </view>
    <view class="popup-input-row">
      <text class="popup-label">包数</text>
      <input class="popup-input" type="number" placeholder="请输入" value="{{outboundCount}}" bindinput="onOutboundCountInput" />
      <text class="popup-unit">包</text>
    </view>
    <view class="popup-btn-row">
      <view class="popup-btn cancel" bindtap="closeOutboundPopup">取消</view>
      <view class="popup-btn confirm" bindtap="submitOutbound">确认</view>
    </view>
  </view>
</t-popup>
