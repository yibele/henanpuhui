<!--
  收苗统计页面
  管理层查看收苗数据汇总
-->
<view class="page-container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">收苗统计</text>
    <text class="page-subtitle">数据更新至 {{updateTime}}</text>
  </view>

  <!-- Tab 切换：今日 / 累计 -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-tab="0">
      <text>今日数据</text>
    </view>
    <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-tab="1">
      <text>累计数据</text>
    </view>
  </view>

  <!-- 核心指标卡片 -->
  <view class="card stats-card">
    <view class="stats-row">
      <!-- 收购总重量（公斤） -->
      <view class="stat-box">
        <text class="stat-value">{{currentStats.totalWeight}}</text>
        <text class="stat-label">收购总重量</text>
      </view>
      <!-- 总金额 -->
      <view class="stat-box">
        <text class="stat-value highlight">{{currentStats.totalAmount}}</text>
        <text class="stat-label">总金额</text>
      </view>
      <!-- 单价 = 总金额/总重量 -->
      <view class="stat-box">
        <text class="stat-value">{{currentStats.avgPrice}}</text>
        <text class="stat-label">单价</text>
      </view>
    </view>
    <!-- 农户数（仅累计显示） -->
    <view class="stat-extra" wx:if="{{currentTab === 1}}">
      <text class="extra-label">已卖叶农户</text>
      <text class="extra-value">{{currentStats.farmerCount}}</text>
    </view>
  </view>

  <!-- 按仓库分类统计 -->
  <view class="section-title">
    <text>按仓库分类</text>
  </view>
  
  <view class="card warehouse-card">
    <view class="warehouse-list">
      <view class="warehouse-item" wx:for="{{warehouseStats}}" wx:key="warehouseId" bindtap="goWarehouseDetail" data-id="{{item.warehouseId}}">
        <view class="warehouse-header">
          <view class="warehouse-name">
            <t-icon name="location" size="32rpx" color="#059669" />
            <text>{{item.warehouseName}}</text>
            <text class="warehouse-type-badge">{{item.warehouseType}}</text>
          </view>
          <view class="warehouse-action">
            <view class="capacity-badge capacity-{{item.capacityStatus}}">
              <text>{{item.usagePercent}}%</text>
            </view>
            <t-icon name="chevron-right" size="32rpx" color="#9ca3af" />
          </view>
        </view>
        <!-- 容量进度条 -->
        <view class="capacity-progress">
          <view class="capacity-bar capacity-bar-{{item.capacityStatus}}" style="width: {{item.usagePercent}}%;"></view>
        </view>
        <view class="capacity-info">
          <text class="capacity-text">库存 {{item.formatCurrentStock}} / {{item.formatCapacity}}</text>
        </view>
        <view class="warehouse-detail">
          <view class="detail-item">
            <text class="detail-label">{{currentTab === 0 ? '今日入库' : '累计收购'}}</text>
            <text class="detail-value">{{item.weightKg}}kg</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">金额</text>
            <text class="detail-value highlight">{{item.formatAmount}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">单价</text>
            <text class="detail-value">{{item.avgPrice}}元/kg</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 数据趋势（仅累计显示） -->
  <view class="section-title" wx:if="{{currentTab === 1}}">
    <text>收购趋势</text>
  </view>
  
  <view class="card trend-card" wx:if="{{currentTab === 1}}">
    <view class="trend-chart">
      <view class="chart-bars">
        <view class="bar-item" wx:for="{{trendData}}" wx:key="date">
          <view class="bar-fill" style="height: {{item.heightPercent}}%;"></view>
          <text class="bar-label">{{item.label}}</text>
        </view>
      </view>
    </view>
    <view class="trend-legend">
      <view class="legend-item">
        <view class="legend-dot"></view>
        <text>日收购量(吨)</text>
      </view>
    </view>
  </view>

  <!-- 底部安全区 -->
  <view class="safe-bottom"></view>
</view>

