<!--
  种苗发放管理页
  查看种苗发放记录
-->
<view class="page-container">
  <!-- 顶部统计卡片 -->
  <view class="stats-header">
    <view class="stats-title-row">
      <text class="stats-title">种苗发放统计</text>
      <view class="add-btn" bindtap="goToSeedAdd">
        <t-icon name="add" size="36rpx" color="#ffffff" />
        <text>新增发放</text>
      </view>
    </view>
    
    <view class="stats-grid">
      <view class="stats-item">
        <text class="stats-value">{{summary.totalQuantity}}</text>
        <text class="stats-label">发放总量</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-value highlight">{{summary.totalAmount}}</text>
        <text class="stats-label">总金额</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-value">{{summary.farmerCount}}</text>
        <text class="stats-label">涉及农户</text>
      </view>
    </view>
    
    <view class="stats-row-secondary">
      <view class="stats-item-small">
        <text class="stats-label-small">发放次数</text>
        <text class="stats-value-small">{{summary.recordCount}}次</text>
      </view>
      <view class="stats-item-small">
        <text class="stats-label-small">覆盖面积</text>
        <text class="stats-value-small">{{summary.totalArea}}</text>
      </view>
    </view>
  </view>

  <!-- Tab 切换：今日/全部 -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-tab="0">
      <text>今日发放</text>
    </view>
    <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-tab="1">
      <text>全部记录</text>
    </view>
  </view>

  <!-- 搜索栏 -->
  <view class="search-bar">
    <view class="search-input-wrap">
      <t-icon name="search" size="36rpx" color="#9ca3af" />
      <input 
        class="search-input" 
        placeholder="搜索农户姓名或手机号" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <view class="search-clear" wx:if="{{searchKeyword}}" bindtap="clearSearch">
        <t-icon name="close-circle-filled" size="32rpx" color="#d1d5db" />
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{pageLoading}}">
    <t-loading theme="circular" size="40rpx" />
    <text>加载中...</text>
  </view>

  <!-- 发放记录列表 -->
  <view class="record-list" wx:if="{{!pageLoading}}">
    <view class="section-title">
      <text>发放记录</text>
      <text class="list-count">共 {{filteredList.length}} 条</text>
    </view>

    <view class="record-item" wx:for="{{displayList}}" wx:key="id" bindtap="goRecordDetail" data-record="{{item}}">
      <view class="record-header">
        <view class="record-farmer">
          <text class="farmer-name">{{item.farmerName}}</text>
          <text class="farmer-phone">{{item.phone}}</text>
        </view>
        <view class="record-amount">
          <text class="amount-value">¥{{item.amount}}</text>
        </view>
      </view>
      <view class="record-body">
        <view class="info-row">
          <text class="info-label">发放数量</text>
          <text class="info-value">{{item.quantity}}株</text>
        </view>
        <view class="info-row">
          <text class="info-label">发放面积</text>
          <text class="info-value">{{item.distributedArea}}亩</text>
        </view>
        <view class="info-row">
          <text class="info-label">领取人</text>
          <text class="info-value">{{item.receiverName}}</text>
        </view>
      </view>
      <view class="record-footer">
        <text class="record-date">{{item.date}}</text>
        <text class="record-manager">操作人：{{item.managerName}}</text>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{hasMore}}" bindtap="loadMore">
      <text>{{loading ? '加载中...' : '加载更多'}}</text>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{filteredList.length === 0}}">
      <t-icon name="folder-open" size="80rpx" color="#d1d5db" />
      <text class="empty-text">{{searchKeyword ? '未找到匹配的记录' : '暂无发放记录'}}</text>
      <view class="empty-btn" bindtap="goToSeedAdd">
        <text>去发放种苗</text>
      </view>
    </view>
  </view>

  <!-- 底部安全区 -->
  <view class="safe-bottom"></view>
</view>
