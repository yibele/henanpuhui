<!--
  新增农户页面（签约农户）
  录入农户签约信息
-->
<view class="add-farmer-page">
  <!-- 基本信息 -->
  <view class="form-section">
    <view class="section-header">
      <view class="section-indicator section-indicator-green"></view>
      <text class="section-title">基本信息</text>
    </view>
    
    <view class="form-card">
      <!-- 姓名 -->
      <view class="form-item">
        <text class="form-label required">农户姓名</text>
        <input 
          class="form-input"
          placeholder="输入农户姓名"
          value="{{form.name}}"
          bindinput="onNameInput"
        />
      </view>
      
      <view class="form-divider"></view>
      
      <!-- 电话 -->
      <view class="form-item">
        <text class="form-label required">联系电话</text>
        <input 
          class="form-input"
          type="number"
          maxlength="11"
          placeholder="输入11位手机号"
          value="{{form.phone}}"
          bindinput="onPhoneInput"
        />
      </view>
      
      <view class="form-divider"></view>
      
      <!-- 身份证号 -->
      <view class="form-item">
        <text class="form-label required">身份证号</text>
        <input 
          class="form-input"
          maxlength="18"
          placeholder="18位身份证号码"
          value="{{form.idCard}}"
          bindinput="onIdCardInput"
        />
      </view>
    </view>
  </view>

  <!-- 签约信息（放在种植地址之前） -->
  <view class="form-section">
    <view class="section-header">
      <view class="section-indicator section-indicator-orange"></view>
      <text class="section-title">签约信息</text>
    </view>
    
    <view class="form-card">
      <!-- 种植面积 - 使用 stepper + input 组合 -->
      <view class="form-item">
        <text class="form-label required">种植面积（亩）</text>
        <view class="stepper-input-row">
          <input 
            class="stepper-input"
            type="digit"
            placeholder="0"
            value="{{form.acreage}}"
            bindinput="onAcreageInput"
          />
          <view class="stepper-controls">
            <view class="stepper-btn stepper-btn-minus" bindtap="onAcreageMinus">
              <t-icon name="remove" size="36rpx" color="{{form.acreage > 0 ? '#059669' : '#d1d5db'}}" />
            </view>
            <view class="stepper-btn stepper-btn-plus" bindtap="onAcreagePlus">
              <t-icon name="add" size="36rpx" color="#059669" />
            </view>
          </view>
        </view>
      </view>
      
      <view class="form-divider"></view>
      
      <!-- 农户等级 -->
      <view class="form-item">
        <text class="form-label required">农户等级</text>
        <view class="grade-tags">
          <view 
            class="grade-tag grade-tag-gold {{form.grade === 'gold' ? 'active' : ''}}"
            data-grade="gold"
            bindtap="onGradeTap"
          >
            <text>🥇 金牌</text>
          </view>
          <view 
            class="grade-tag grade-tag-silver {{form.grade === 'silver' ? 'active' : ''}}"
            data-grade="silver"
            bindtap="onGradeTap"
          >
            <text>🥈 银牌</text>
          </view>
          <view 
            class="grade-tag grade-tag-bronze {{form.grade === 'bronze' ? 'active' : ''}}"
            data-grade="bronze"
            bindtap="onGradeTap"
          >
            <text>🥉 铜牌</text>
          </view>
        </view>
      </view>
      
      <view class="form-divider"></view>
      
      <!-- 定金 - 使用 stepper + input 组合 -->
      <view class="form-item">
        <text class="form-label">定金（元）</text>
        <view class="stepper-input-row">
          <view class="deposit-input-wrapper">
            <text class="deposit-prefix">¥</text>
            <input 
              class="stepper-input deposit-input"
              type="digit"
              placeholder="0"
              value="{{form.deposit}}"
              bindinput="onDepositInput"
            />
          </view>
          <view class="stepper-controls">
            <view class="stepper-btn stepper-btn-minus" bindtap="onDepositMinus">
              <t-icon name="remove" size="36rpx" color="{{form.deposit > 0 ? '#ea580c' : '#d1d5db'}}" />
            </view>
            <view class="stepper-btn stepper-btn-plus" bindtap="onDepositPlus">
              <t-icon name="add" size="36rpx" color="#ea580c" />
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 种植地址（四级） -->
  <view class="form-section">
    <view class="section-header">
      <view class="section-indicator section-indicator-blue"></view>
      <text class="section-title">种植地址</text>
    </view>
    
    <view class="form-card">
      <view class="address-grid">
        <!-- 县城 -->
        <view class="address-item">
          <text class="form-label required">县/区</text>
          <input 
            class="form-input"
            placeholder="输入县/区"
            value="{{form.county}}"
            bindinput="onCountyInput"
          />
        </view>
        
        <!-- 乡 -->
        <view class="address-item">
          <text class="form-label">乡</text>
          <input 
            class="form-input"
            placeholder="输入乡"
            value="{{form.township}}"
            bindinput="onTownshipInput"
          />
        </view>
        
        <!-- 镇 -->
        <view class="address-item">
          <text class="form-label">镇</text>
          <input 
            class="form-input"
            placeholder="输入镇"
            value="{{form.town}}"
            bindinput="onTownInput"
          />
        </view>
        
        <!-- 村 -->
        <view class="address-item">
          <text class="form-label required">村/组</text>
          <input 
            class="form-input"
            placeholder="输入村/组"
            value="{{form.village}}"
            bindinput="onVillageInput"
          />
        </view>
      </view>
    </view>
  </view>

  <!-- 负责人信息（自动绑定当前登录用户） -->
  <view class="form-section">
    <view class="section-header">
      <view class="section-indicator section-indicator-purple"></view>
      <text class="section-title">负责人信息</text>
    </view>
    
    <view class="form-card">
      <view class="manager-info">
        <view class="manager-row">
          <text class="manager-label">种植户负责人</text>
          <view class="manager-value">
            <t-icon name="user-circle" size="36rpx" color="#8b5cf6" />
            <text class="manager-name">{{managerName}}</text>
            <view class="manager-tag">当前账号</view>
          </view>
        </view>
        <view class="manager-hint">
          <t-icon name="info-circle" size="28rpx" color="#9ca3af" />
          <text>负责人已自动绑定为当前登录账号</text>
        </view>
      </view>
      
      <!-- 客户编码预览 -->
      <view class="form-divider" wx:if="{{customerCodePreview}}"></view>
      <view class="code-preview" wx:if="{{customerCodePreview}}">
        <text class="code-label">客户编码（自动生成）</text>
        <text class="code-value">{{customerCodePreview}}</text>
      </view>
    </view>
  </view>

  <!-- 照片上传 -->
  <view class="form-section">
    <view class="section-header">
      <view class="section-indicator section-indicator-teal"></view>
      <text class="section-title">证件与合同</text>
    </view>
    
    <view class="form-card">
      <!-- 身份证照片 -->
      <view class="upload-section">
        <text class="upload-title">身份证照片（正反面）</text>
        <view class="upload-row">
          <view class="upload-btn" bindtap="onChooseIdPhoto" wx:if="{{idCardImages.length < 2}}">
            <t-icon name="camera" size="48rpx" color="#9ca3af" />
            <text class="upload-text">拍摄身份证</text>
          </view>
          
          <!-- 已上传的身份证照片 -->
          <view 
            wx:for="{{idCardImages}}" 
            wx:key="*this"
            class="uploaded-image-item"
          >
            <image class="uploaded-image" src="{{item}}" mode="aspectFill" />
            <view 
              class="delete-btn"
              data-index="{{index}}"
              catchtap="onDeleteIdPhoto"
            >
              <t-icon name="close" size="24rpx" color="#ffffff" />
            </view>
            <text class="image-label">{{index === 0 ? '正面' : '反面'}}</text>
          </view>
        </view>
      </view>
      
      <view class="form-divider"></view>
      
      <!-- 合同照片 -->
      <view class="upload-section">
        <text class="upload-title">合同照片</text>
        <view class="upload-row">
          <view class="upload-btn" bindtap="onChooseContractPhoto">
            <t-icon name="upload" size="48rpx" color="#9ca3af" />
            <text class="upload-text">上传合同</text>
          </view>
          
          <!-- 已上传的合同照片 -->
          <view 
            wx:for="{{contractImages}}" 
            wx:key="*this"
            class="uploaded-image-item"
          >
            <image class="uploaded-image" src="{{item}}" mode="aspectFill" />
            <view 
              class="delete-btn"
              data-index="{{index}}"
              catchtap="onDeleteContractPhoto"
            >
              <t-icon name="close" size="24rpx" color="#ffffff" />
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 提示信息 -->
  <view class="tips">
    <text>* 标记为必填项，确认保存后该农户将进入系统管理。</text>
  </view>

  <!-- 底部按钮 -->
  <view class="bottom-actions">
    <button class="btn btn-cancel" bindtap="onCancel">取消</button>
    <button 
      class="btn btn-submit" 
      bindtap="onSubmit"
      loading="{{submitting}}"
    >确认签约</button>
  </view>
</view>
