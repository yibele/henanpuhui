<!--
  发放种苗页面
-->
<view class="form-page">
  <view class="form-card">
    <!-- 选择农户 -->
    <view class="form-item" bindtap="showFarmerSelect">
      <text class="form-label">接收农户</text>
      <view class="form-value-row">
        <text class="form-value {{selectedFarmer ? '' : 'form-placeholder'}}">
          {{selectedFarmer.name || '点击选择农户'}}
        </text>
        <t-icon name="chevron-right" size="40rpx" color="#d1d5db" />
      </view>
    </view>

    <view class="form-divider"></view>

    <!-- 选择种苗 -->
    <view class="form-item" bindtap="showSeedSelect">
      <text class="form-label">种苗品类</text>
      <view class="form-value-row">
        <text class="form-value">{{seedOptions[seedIndex]}}</text>
        <t-icon name="chevron-right" size="40rpx" color="#d1d5db" />
      </view>
    </view>

    <view class="form-divider"></view>

    <!-- 发放数量 -->
    <view class="form-item">
      <text class="form-label">发放数量 (kg)</text>
      <input 
        class="quantity-input"
        type="digit"
        placeholder="0.00"
        value="{{quantity}}"
        bindinput="onQuantityInput"
      />
    </view>
  </view>

  <view class="form-tip">
    * 提交后系统将自动扣减库存并生成农户领取记录。
  </view>

  <!-- 底部按钮 -->
  <view class="bottom-actions">
    <button class="btn btn-cancel" bindtap="onCancel">取消</button>
    <button 
      class="btn btn-submit" 
      bindtap="onSubmit"
      loading="{{submitting}}"
    >提交</button>
  </view>

  <!-- 农户选择弹窗 -->
  <t-popup 
    visible="{{showFarmerPopup}}" 
    placement="bottom"
    bind:visible-change="closeFarmerPopup"
  >
    <view class="farmer-popup">
      <view class="popup-header">
        <text class="popup-title">选择农户</text>
        <view class="popup-close" bindtap="closeFarmerPopup">
          <t-icon name="close" size="40rpx" color="#6b7280" />
        </view>
      </view>
      <view class="popup-search">
        <t-search
          placeholder="搜索姓名或手机号"
          value="{{searchValue}}"
          bind:change="onSearchFarmer"
        />
      </view>
      <scroll-view class="farmer-list" scroll-y>
        <view 
          wx:for="{{filteredFarmers}}" 
          wx:key="id"
          class="farmer-item"
          data-id="{{item.id}}"
          bindtap="onSelectFarmer"
        >
          <view class="farmer-item-info">
            <text class="farmer-item-name">{{item.name}}</text>
            <text class="farmer-item-addr">{{item.address}}</text>
          </view>
          <t-icon 
            wx:if="{{selectedFarmer.id === item.id}}" 
            name="check" 
            size="40rpx" 
            color="#059669" 
          />
        </view>
      </scroll-view>
    </view>
  </t-popup>

  <!-- 种苗选择器 -->
  <t-picker
    visible="{{showSeedPicker}}"
    value="{{[seedIndex]}}"
    title="选择种苗品类"
    cancelBtn="取消"
    confirmBtn="确认"
    bind:confirm="onSeedConfirm"
    bind:cancel="onSeedCancel"
  >
    <t-picker-item options="{{seedOptions}}" />
  </t-picker>

  <!-- Toast -->
  <t-toast 
    visible="{{toastVisible}}" 
    message="{{toastMessage}}"
    bind:close="onToastClose"
  />
</view>

